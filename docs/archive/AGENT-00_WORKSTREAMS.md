# AGENT-00_WORKSTREAMS (多 Agent 分工与上下文注入规范)

**目标**：支持在 Vibe Coding 模式下，将后端与前端工作拆分给不同能力更匹配的 Agent 团队并行/串行实施；每个阶段文档提供足够“可启动上下文”，使独立上下文窗口中的 Agent 能直接执行该阶段任务并交付可验收产物。

---

## 1. Agent 团队与职责边界

### 1.1 Codex Agent 团队（后端）

- **主要范围**：
  - FastAPI 路由与数据契约（含 `{ ok, data, error }`）
  - 网关代理（文本/图像/视频）、鉴权、限流、日志脱敏
  - COS/Supabase 等服务端集成与安全策略
  - 任务状态、轮询接口、幂等与重试策略
- **禁止范围**：
  - 前端 UI 视觉与交互实现
  - 在前端引入任何密钥或绕过后端代理

### 1.2 Gemini Agent 团队（前端）

- **主要范围**：
  - React/Vite/Tailwind UI 基座迁移与 Google 风格 Light Theme 落地
  - 工作流页面与交互、状态管理、错误提示与可用性
  - `apiClient.ts` 唯一 API 入口与请求/响应适配
  - Prompt 展示与复制、任务列表与预览组件
- **禁止范围**：
  - 直接调用外部 AI API（含 `ai.t8star.cn`）
  - 修改后端数据契约或安全门禁（必须走对应后端 PLAN/PRD/ARCH 变更）

---

## 2. 工作归属标记（文件级）

- **文档归属**：
  - `PLAN-01/02/03/07/08/09/10`：后端主导（Codex），前端协作点在文档内单列
  - `PLAN-04/06`：前端主导（Gemini），后端协作点在文档内单列
  - `PLAN-05`：前后端共同（以数据契约为中枢）
- **实现归属**：
  - 后端：`backend/**`
  - 前端：`frontend/**`
  - 文档：`docs/**`（由本阶段负责人更新，但必须保证跨团队一致性）

---

## 3. 阶段文档的“上下文注入包”模板（必须）

每个 `PLAN-*` 文档追加一个同结构的小节：`## Agent 上下文注入包`，用于启动独立上下文窗口的 Agent。

### 3.1 通用字段（所有 PLAN 必填）

- **负责人团队**：Codex(后端) / Gemini(前端) / Joint(共同)
- **本阶段目标**：一句话产出定义
- **输入（从哪里来）**：依赖哪些配置、哪些上游产物、哪些文档
- **输出（交付物）**：要生成哪些文件/接口/页面/可验收证据
- **冻结约束**：
  - `{ ok, data, error }` 统一结构
  - Prompt 单一来源（后端）
  - 前端 API Client 单一入口
  - UI 语言为简体中文
  - Prompt 输出语种由规则控制（`output_language` / `{{Output_Language_Rule}}`）
- **禁止事项（高风险）**：本阶段最容易误改/误做的点
- **验收 Checklist**：3-7 条可执行的检查点
- **回滚策略**：失败时如何回到上一个可用状态

### 3.2 面向 Codex Agent（后端）的注入 Prompt 模板

```text
你是 Codex Agent（后端负责人）。
只允许修改 backend/** 与 docs/** 中标注“后端主导/共同”的文档段落。
严格遵守冻结项：统一响应结构、日志脱敏、禁止 SSRF、禁止密钥泄露、前端禁止直连外部 API。

本阶段目标：{{本阶段目标}}
输入：{{输入}}
输出：{{输出}}
验收：{{验收Checklist}}
回滚：{{回滚策略}}

交付时必须附带：
1) 成功路径与失败路径的可复现验证方式
2) 修改过的文档段落与契约变化说明（若有）
```

### 3.3 面向 Gemini Agent（前端）的注入 Prompt 模板

```text
你是 Gemini Agent（前端负责人）。
只允许修改 frontend/** 与 docs/** 中标注“前端主导/共同”的文档段落。
严格遵守冻结项：所有 API 仅走 apiClient.ts；不直连外部 AI API；界面文案仅简体中文；视觉风格为 Google 风格 Light Theme。

本阶段目标：{{本阶段目标}}
输入：{{输入}}
输出：{{输出}}
验收：{{验收Checklist}}
回滚：{{回滚策略}}

交付时必须附带：
1) 关键页面/组件的交互说明（成功路径 + 错误路径）
2) 视觉一致性说明（Light Theme 下的间距/字号/层级规则）
```

---

## 4. 并行/串行协作规则（最小机制）

- **串行优先的交叉点**：
  - 数据契约变更、鉴权方式变更、错误码与状态枚举变更
- **可并行的交付**：
  - 后端先提供 mock 契约与样例响应，前端按契约实现 UI 与状态机
  - 前端先输出页面结构与交互，后端按接口清单补齐实现
- **冲突处理**：
  - 任意团队发现契约不一致，先更新对应 `PLAN-*` 的“输入/输出/验收”再改实现

