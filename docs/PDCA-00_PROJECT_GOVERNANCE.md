# PDCA-00_PROJECT_GOVERNANCE (PDCA 治理与 Vibe Coding 开发协议)

**目标**：让 `GRIDWORKFLOW_ROOT` 下的方案与实现持续可靠更新，且在 Vibe Coding 模式下对 Agent 足够友好（可分解、可验收、可回滚、可追溯）。

---

## 1. 工作对象与边界

- **工作区唯一性**：新项目的唯一工作区为 `GRIDWORKFLOW_ROOT`（剥离前暂存于母体仓库内，剥离后迁移为独立根目录），任何新方案与实现以此为准。
- **文档即真相**：所有模块的“范围/接口/验收/风险/回滚”以对应 `PLAN-*` 与 `requirements/*` 为准，代码实现必须向文档对齐。
- **阶段性优先级**：先做“可跑通 + 可追踪 + 可回滚”，再做“更强大 + 更漂亮”。

---

## 2. 统一产物规范（保证可追溯）

- **每个模块必须具备**：
  - 清晰范围（包含/不包含）
  - 输入/输出（含数据契约/字段约束）
  - 关键实现点（必须做 / 禁止做）
  - 验收标准（可执行的 Check）
  - 风险点与回滚策略
- **变更记录最小要求**：
  - 变更动机（Why）
  - 影响范围（What）
  - 验证证据（Check 结果）
  - 后续动作（Act）

---

## 3. PDCA 运行机制（按模块循环）

### 3.1 Plan（计划）

- 明确本次迭代模块与交付物（产出文件/接口/页面/任务流）。
- 明确“不做什么”（范围外内容显式写出）。
- 明确验收标准（必须可执行、可复现）。
- 明确风险与回滚路径（失败时如何退回到可用状态）。

### 3.2 Do（执行）

- 仅在模块范围内实现最小闭环，避免跨模块混改。
- 优先实现数据契约与错误处理路径，再做 UI/体验细节。
- 对外部依赖（网关、COS、Supabase）先做连通性验证，再进入业务编排。

### 3.3 Check（检查）

- 使用模块文档中的验收条目逐条核对，输出“通过/阻断”结论。
- 形成最小证据：
  - API：请求/响应样例、状态码、失败样例
  - UI：关键流程截图/录屏要点（或明确的交互描述）
  - 稳定性：超时/重试/限流是否符合约束

### 3.4 Act（改进/固化）

- 若通过：将“有效做法”固化到对应文档的“关键实现点/风险点”里。
- 若阻断：把阻断原因写入对应文档，并给出最短修复路径（下一轮 Plan）。
- 若出现反复问题：增加约束（例如字段冻结、接口冻结、模板冻结）或增加测试门禁。

---

## 4. 架构师视角：必须清晰化的关键不变量

- **统一响应结构冻结**：所有后端接口返回 `{ ok, data, error }`，不允许返回 raw data。
- **Prompt 单一来源**：Prompt 模板与拼接逻辑仅存在于后端（前端只展示必要可见 Prompt）。
- **外部调用统一入口**：前端禁止直连 `ai.t8star.cn`；后端禁止在业务层散落拼接外部 URL。
- **媒体统一出站**：图片/视频统一落 COS（或可替换的对象存储），前端只持有 URL。
- **任务必须可追踪**：视频生成必须返回 `task_id`，并提供状态查询与失败原因透出（脱敏）。
- **界面语言冻结**：前端界面语言统一为简体中文（zh-CN）作为落地实现。
- **Prompt 输出语种可控**：LLM 输出语种由显式规则控制，避免由模型自行选择导致不稳定。

---

## 5. Vibe Coding 模式下的 Agent 协作协议（Agent-Friendly）

### 5.1 Agent 的工作方式（默认约束）

- 单次变更只聚焦一个模块（对应一个 `PLAN-*`），禁止跨模块混改。
- 所有新增/修改必须同步更新相关文档的“PDCA 钩子”段落（至少更新 Check/Act）。
- 任何可能破坏兼容性的变更，必须先更新数据契约与验收标准，再改实现。
- 多 Agent 分工与上下文注入规则见 `AGENT-00_WORKSTREAMS.md`，各阶段必须在对应 PLAN 中补齐“Agent 上下文注入包”。

### 5.2 Agent 的变更安全边界（必须遵守）

- 禁止引入密钥到仓库；禁止在日志输出密钥、完整 Prompt、签名 URL 参数。
- 禁止修改目录结构与核心冻结项（统一响应结构、Prompt 单一来源、API Client 单一入口）。
- 禁止自动“结构化 Prompt”（把 Prompt 改造成 JSON 或强制模板化输出）。

### 5.3 Agent 的最小交付形态（Definition of Done）

- 文档更新：范围/输入输出/验收/风险/回滚完整且一致。
- 可验证：至少给出 1 个成功路径与 1 个失败路径的 Check 方式。
- 可回滚：明确如何撤销到上一个可用状态（配置切换/功能开关/保留旧接口）。
