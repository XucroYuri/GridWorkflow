# GridWorkflow 技术债务追踪表

**创建日期**: 2026-01-07  
**最后更新**: 2026-01-07  
**文档版本**: v1.0  

---

## 📊 债务概览

| 优先级 | 数量 | 预估工时 |
|--------|------|----------|
| P0 (阻塞) | 3 | 16h |
| P1 (高优) | 5 | 40h |
| P2 (中优) | 6 | 32h |
| P3 (低优) | 4 | 24h |
| **总计** | **18** | **112h** |

---

## 🔴 P0 - 阻塞级债务

### TD-001: listTasks API 未实现

| 属性 | 值 |
|------|-----|
| **状态** | 🔴 未修复 |
| **影响范围** | 任务列表功能完全不可用 |
| **相关文件** | `backend/app/api/routes/video.py`, `frontend/src/services/videoService.ts` |
| **预估工时** | 8h (含持久化层) |
| **依赖** | 需要先实现数据持久化层 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#S1 |

### TD-002: task.progress 属性缺失

| 属性 | 值 |
|------|-----|
| **状态** | 🔴 未修复 |
| **影响范围** | 前端运行时错误，进度显示异常 |
| **相关文件** | `frontend/src/services/videoService.ts`, `frontend/src/components/video/TaskList.tsx`, `frontend/src/components/video/VideoPreview.tsx` |
| **预估工时** | 2h |
| **依赖** | 无 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#S2 |

### TD-003: CORS 默认配置不安全

| 属性 | 值 |
|------|-----|
| **状态** | 🔴 未修复 |
| **影响范围** | 生产环境安全风险 |
| **相关文件** | `backend/app/main.py` |
| **预估工时** | 2h |
| **依赖** | 需要确定生产域名 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#S3 |

---

## 🟡 P1 - 高优先级债务

### TD-004: httpx 客户端无连接复用

| 属性 | 值 |
|------|-----|
| **状态** | 🟡 待处理 |
| **影响范围** | API 响应延迟增加，资源浪费 |
| **相关文件** | `backend/app/services/ai_service.py`, `backend/app/services/video_service.py` |
| **预估工时** | 4h |
| **依赖** | 无 |
| **修复方案** | 创建共享 httpx.AsyncClient 单例 |

### TD-005: 无 Rate Limiting

| 属性 | 值 |
|------|-----|
| **状态** | 🟡 待处理 |
| **影响范围** | API 被滥用风险，成本失控 |
| **相关文件** | `backend/app/main.py`, 所有路由 |
| **预估工时** | 8h |
| **依赖** | 需要选择限流策略 |
| **修复方案** | 集成 slowapi 或自定义中间件 |

### TD-006: 工作流状态无持久化

| 属性 | 值 |
|------|-----|
| **状态** | 🟡 待处理 |
| **影响范围** | 刷新页面丢失所有进度 |
| **相关文件** | `frontend/src/components/video/GridWorkflow.tsx` |
| **预估工时** | 8h (localStorage) / 16h (后端持久化) |
| **依赖** | 无 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#M3 |

### TD-007: 缺少单元测试

| 属性 | 值 |
|------|-----|
| **状态** | 🟡 待处理 |
| **影响范围** | 回归风险高，重构困难 |
| **相关文件** | `backend/tests/` (空目录) |
| **预估工时** | 16h (核心模块覆盖) |
| **依赖** | pytest 环境配置 |
| **修复方案** | 优先覆盖 services 和 schemas |

### TD-008: Pydantic v1 语法

| 属性 | 值 |
|------|-----|
| **状态** | 🟡 待处理 |
| **影响范围** | 未来版本兼容性风险 |
| **相关文件** | `backend/app/schemas/video.py` |
| **预估工时** | 4h |
| **依赖** | 无 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#M4 |

---

## 🔵 P2 - 中优先级债务

### TD-009: GridWorkflow.tsx 组件过大

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 可维护性差，测试困难 |
| **相关文件** | `frontend/src/components/video/GridWorkflow.tsx` (469 行) |
| **预估工时** | 8h |
| **依赖** | 无 |
| **修复方案** | 拆分为 StepInput, StepConcept, StepStoryboard 等子组件 |

### TD-010: 日志语言混合

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 代码一致性 |
| **相关文件** | 全局 |
| **预估工时** | 4h |
| **依赖** | 团队约定 |
| **修复方案** | 统一使用中文或英文 |

### TD-011: 路由层包含业务逻辑

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 职责不清，测试困难 |
| **相关文件** | `backend/app/api/routes/workflow.py` |
| **预估工时** | 6h |
| **依赖** | 无 |
| **修复方案** | 将业务逻辑迁移至 workflow_service.py |

### TD-012: apiClient timeout 过短

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 长时间请求超时 |
| **相关文件** | `frontend/src/services/apiClient.ts` |
| **预估工时** | 2h |
| **依赖** | 无 |
| **修复方案** | 根据端点类型设置不同超时 |

### TD-013: EMPTY_1X1_PNG 硬编码

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 代码可读性 |
| **相关文件** | `backend/app/services/ai_service.py` |
| **预估工时** | 2h |
| **依赖** | 无 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#L1 |

### TD-014: fetchTasks 依赖循环风险

| 属性 | 值 |
|------|-----|
| **状态** | 🔵 待处理 |
| **影响范围** | 潜在无限渲染 |
| **相关文件** | `frontend/src/pages/VideoStudio.tsx` |
| **预估工时** | 2h |
| **依赖** | 无 |
| **修复方案** | 重构 useCallback 依赖数组 |

---

## 🟢 P3 - 低优先级债务

### TD-015: 缺少暗色主题

| 属性 | 值 |
|------|-----|
| **状态** | 🟢 待处理 |
| **影响范围** | 用户体验 |
| **相关文件** | `frontend/src/index.css` |
| **预估工时** | 8h |
| **依赖** | 设计稿 |
| **修复方案** | 见 CODE_ISSUES_DETAIL.md#L3 |

### TD-016: 缺少 i18n 国际化

| 属性 | 值 |
|------|-----|
| **状态** | 🟢 待处理 |
| **影响范围** | 国际用户体验 |
| **相关文件** | 全局 |
| **预估工时** | 16h |
| **依赖** | react-i18next 集成 |
| **修复方案** | 提取所有硬编码文本 |

### TD-017: 缺少 OpenAPI 示例

| 属性 | 值 |
|------|-----|
| **状态** | 🟢 待处理 |
| **影响范围** | API 文档不完整 |
| **相关文件** | `backend/app/schemas/*.py` |
| **预估工时** | 4h |
| **依赖** | 无 |
| **修复方案** | 添加 Pydantic Field(example=...) |

### TD-018: 侧边栏状态无持久化

| 属性 | 值 |
|------|-----|
| **状态** | 🟢 待处理 |
| **影响范围** | 用户偏好丢失 |
| **相关文件** | `frontend/src/App.tsx` |
| **预估工时** | 2h |
| **依赖** | 无 |
| **修复方案** | localStorage 存储 |

---

## 📅 建议修复路线图

### 第 1 周：修复阻塞问题

```
Day 1-2: TD-002 (task.progress) + TD-003 (CORS)
Day 3-5: TD-001 (listTasks) - 需要设计持久化方案
```

### 第 2 周：安全与性能

```
Day 1-2: TD-004 (httpx 连接池)
Day 3-5: TD-005 (Rate Limiting)
```

### 第 3-4 周：可维护性

```
Week 3: TD-007 (单元测试) + TD-008 (Pydantic v2)
Week 4: TD-009 (组件拆分) + TD-006 (状态持久化)
```

### 第 5 周+：优化迭代

```
TD-010 ~ TD-018 根据优先级逐步处理
```

---

## 📝 债务记录模板

```markdown
### TD-XXX: [债务标题]

| 属性 | 值 |
|------|-----|
| **状态** | 🔴 未修复 / 🟡 进行中 / 🟢 已修复 |
| **影响范围** | [描述影响] |
| **相关文件** | [文件路径] |
| **预估工时** | Xh |
| **依赖** | [前置依赖] |
| **修复方案** | [简述或链接] |
| **修复日期** | YYYY-MM-DD |
| **修复者** | [姓名/ID] |
```

---

## 📊 债务趋势追踪

| 日期 | P0 | P1 | P2 | P3 | 总计 |
|------|----|----|----|----|------|
| 2026-01-07 | 3 | 5 | 6 | 4 | 18 |
| | | | | | |
| | | | | | |

---

**文档维护者**: AI Auditor  
**审核周期**: 每两周更新一次

