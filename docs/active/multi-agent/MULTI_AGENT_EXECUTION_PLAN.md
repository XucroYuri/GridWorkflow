# GridWorkflow å¤šAgentåä½œæ‰§è¡Œæ–¹æ¡ˆ

> **ç‰ˆæœ¬**: 2026-01-08 v2.0  
> **åŸºäº**: [MASTER_PLAN_2026.md](../../MASTER_PLAN_2026.md)  
> **ç›®æ ‡**: é€šè¿‡å¤šAgentå¹¶è¡Œ/ä¸²è¡Œåä½œï¼Œé«˜æ•ˆæ¨è¿›Phase 1-2ä»»åŠ¡

---

## ğŸ“– ç›®å½•

1. [å…¨å±€å†»ç»“é¡¹ï¼ˆé—¨ç¦ï¼‰](#0-å…¨å±€å†»ç»“é¡¹é—¨ç¦)
2. [Agent è§’è‰²å®šä¹‰](#1-agent-è§’è‰²å®šä¹‰)
3. [çª—å£ç­–ç•¥ä¸ç®¡ç†](#2-çª—å£ç­–ç•¥ä¸ç®¡ç†)
4. [Phase 1 æ‰§è¡Œè·¯çº¿å›¾](#3-phase-1-æ‰§è¡Œè·¯çº¿å›¾)
5. [Stage è¯¦ç»†æ‰§è¡Œæ–¹æ¡ˆ](#4-stage-è¯¦ç»†æ‰§è¡Œæ–¹æ¡ˆ)
6. [éªŒæ”¶ä¸é—¨ç¦æ‰§è¡Œ](#5-éªŒæ”¶ä¸é—¨ç¦æ‰§è¡Œ)
7. [Git æäº¤æµç¨‹](#6-git-æäº¤æµç¨‹)
8. [æ£€æŸ¥æ¸…å•](#7-æ£€æŸ¥æ¸…å•)

---

## 0. å…¨å±€å†»ç»“é¡¹ï¼ˆé—¨ç¦ï¼‰

> âš ï¸ **é‡è¦**ï¼šæ‰€æœ‰Agentåœ¨ä»»ä½•ä»»åŠ¡ä¸­éƒ½å¿…é¡»éµå®ˆè¿™äº›ä¸å¯å˜é¡¹ï¼Œè¿åè€…ç›´æ¥é€€å›ã€‚

### 0.1 ç»Ÿä¸€å“åº”ç»“æ„

**æ‰€æœ‰åç«¯ API å¿…é¡»è¿”å›**ï¼š

```json
{
  "ok": true,
  "data": {},
  "error": null
}
```

**å¤±è´¥æ—¶**ï¼š

```json
{
  "ok": false,
  "data": null,
  "error": {
    "code": "BAD_REQUEST",
    "message": "..."
  }
}
```

- âŒ ç¦æ­¢è¿”å› raw data
- âŒ ç¦æ­¢é€ä¼ ä¸Šæ¸¸å®Œæ•´é”™è¯¯ä½“
- âœ… é”™è¯¯ä¿¡æ¯å¿…é¡»è„±æ•

### 0.2 Prompt å•ä¸€æ¥æºï¼ˆåç«¯ï¼‰

- Prompt æ¨¡æ¿ä¸æ‹¼æ¥é€»è¾‘ä»…å­˜åœ¨äºåç«¯ï¼ˆ`backend/app/core/prompts.py`ï¼‰
- å‰ç«¯åªå±•ç¤ºä¸ç¼–è¾‘å¯è§ Promptï¼Œä¸åšæ¨¡æ¿æ‹¼æ¥
- âŒ ç¦æ­¢åœ¨å‰ç«¯æš´éœ²å®Œæ•´ç³»ç»Ÿæç¤ºè¯

### 0.3 å‰ç«¯ API Client å•ä¸€å…¥å£

- æ‰€æœ‰ API è¯·æ±‚å¿…é¡»é€šè¿‡ `frontend/src/services/apiClient.ts`
- âŒ ç¦æ­¢åœ¨ç»„ä»¶ä¸­æ•£è½ `fetch` æˆ–ç›´æ¥è°ƒç”¨å¤–éƒ¨ URL
- âŒ ç¦æ­¢å‰ç«¯ç›´è¿ `ai.t8star.cn` æˆ–ä»»ä½•å¤–éƒ¨ AI API

### 0.4 UI æ–‡æ¡ˆä»…ç®€ä½“ä¸­æ–‡

- ç•Œé¢è¯­è¨€ç»Ÿä¸€ä¸ºç®€ä½“ä¸­æ–‡ï¼ˆzh-CNï¼‰
- æŒ‰é’®ã€æ ‡ç­¾ã€æç¤ºä¿¡æ¯ã€é”™è¯¯ä¿¡æ¯å‡ä½¿ç”¨ä¸­æ–‡
- ä»£ç /æ—¥å¿—/æ¥å£å†…éƒ¨å¯ç”¨è‹±æ–‡

### 0.5 å®‰å…¨é—¨ç¦

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| å¯†é’¥è„±æ• | `AI_GATEWAY_API_KEY`ã€`COS_SECRET_KEY`ã€`SUPABASE_SERVICE_ROLE_KEY` ç¦æ­¢è¾“å‡ºåˆ°æ—¥å¿— |
| å¤–éƒ¨è°ƒç”¨éš”ç¦» | å‰ç«¯ç¦æ­¢ç›´è¿å¤–éƒ¨ AI APIï¼Œç»Ÿä¸€èµ°åç«¯ä»£ç† |
| ä¸Šæ¸¸é”™è¯¯è„±æ• | ç¦æ­¢å°†ä¸Šæ¸¸å®Œæ•´é”™è¯¯ä½“åŸæ ·é€ä¼ ç»™å‰ç«¯ |
| æ—¥å¿—å­—æ®µé™åˆ¶ | ä»…è®°å½• `request_id`ã€`model`ã€`step`ã€`latency_ms` |

### 0.6 é”™è¯¯ç è§„èŒƒï¼ˆå†»ç»“ï¼‰

| é”™è¯¯ç  | å«ä¹‰ |
|--------|------|
| `BAD_REQUEST` | å…¥å‚ç¼ºå¤±/æ ¼å¼ä¸å¯¹/è¶…é™ |
| `UNAUTHORIZED` | é‰´æƒå¤±è´¥ |
| `FORBIDDEN` | æ— æƒé™è®¿é—®èµ„æº |
| `NOT_FOUND` | èµ„æº/ä»»åŠ¡ä¸å­˜åœ¨ |
| `UPSTREAM_ERROR` | ä¸Šæ¸¸æœåŠ¡é”™è¯¯ï¼ˆè„±æ•ï¼‰ |
| `TIMEOUT` | ä¸Šæ¸¸è¶…æ—¶æˆ–å†…éƒ¨è¶…æ—¶ |
| `RATE_LIMITED` | è¶…å‡ºé™æµ |

### 0.7 ä»»åŠ¡çŠ¶æ€æšä¸¾ï¼ˆå†»ç»“ï¼‰

| çŠ¶æ€ | å«ä¹‰ |
|------|------|
| `queued` | æ’é˜Ÿä¸­ |
| `running` | æ‰§è¡Œä¸­ |
| `succeeded` | æˆåŠŸ |
| `failed` | å¤±è´¥ |

> ğŸ“„ å®Œæ•´å†»ç»“é¡¹æ–‡æ¡£ï¼š[FROZEN_INVARIANTS.md](./FROZEN_INVARIANTS.md)

---

## 1. Agent è§’è‰²å®šä¹‰

| Agent | ä»£å· | ç‰¹é•¿ | è´Ÿè´£é¢†åŸŸ |
|-------|------|------|----------|
| **Claude** | `@Expert` | ä»£ç å®¡æŸ¥ã€æ¶æ„è®¾è®¡ã€è´¨é‡æŠŠæ§ | ä»£ç å®¡æ ¸ã€æ–¹æ¡ˆè¯„å®¡ã€ç–‘éš¾é—®é¢˜ã€å®‰å…¨å®¡é˜… |
| **Codex** | `@Backend` | åç«¯å¼€å‘ã€APIè®¾è®¡ã€æ•°æ®åº“ | Python/FastAPIã€Supabaseã€æµ‹è¯• |
| **Gemini** | `@Frontend` | å‰ç«¯å¼€å‘ã€UI/UXã€äº¤äº’è®¾è®¡ | React/TypeScriptã€ç»„ä»¶ã€æ ·å¼ |
| **Joint** | `@Joint` | è”è°ƒé›†æˆ | è·¨å‰åç«¯è”è°ƒã€å¥‘çº¦éªŒè¯ |

### åˆ†å·¥åŸåˆ™

1. **Codex Teamï¼ˆåç«¯ï¼‰**ï¼šå®ç° `backend/**`ï¼Œè´Ÿè´£æ•°æ®å¥‘çº¦ã€å®‰å…¨ã€ä»£ç†ã€å­˜å‚¨ã€é‰´æƒã€ä»»åŠ¡ç³»ç»Ÿ
2. **Gemini Teamï¼ˆå‰ç«¯ï¼‰**ï¼šå®ç° `frontend/**`ï¼Œè´Ÿè´£ Light Theme UIã€äº¤äº’ã€çŠ¶æ€æœºã€apiClient
3. **Joint Agentï¼ˆé›†æˆï¼‰**ï¼šåªåš"è”è°ƒä¸éªŒæ”¶"ç±»å˜æ›´ï¼Œç¦æ­¢å¼•å…¥æ–°éœ€æ±‚ï¼›ä¿®å¤å¿…é¡»å›å†™åˆ°å¯¹åº”æ–¹æ¡ˆçš„éªŒæ”¶æ¡ç›®
4. **Claudeï¼ˆExpertï¼‰**ï¼šæŠŠå…³å®¡æ ¸ã€æ¶æ„å†³ç­–ã€å®‰å…¨å¤æ ¸

---

## 2. çª—å£ç­–ç•¥ä¸ç®¡ç†

### 2.1 çª—å£ç¼–å·è§„åˆ™

| ç±»å‹ | ç¼–å·æ ¼å¼ | è¯´æ˜ |
|------|----------|------|
| ä¸²è¡Œçª—å£ | `S1`, `S2`, ... | æ–°å¼€çª—å£ï¼Œé¿å…å†å²ä¸Šä¸‹æ–‡å¹²æ‰° |
| å¹¶è¡Œçª—å£ | `P1`, `P2`, ... | ä¸ºæ¯ä¸ªå¹¶è¡ŒAgentåˆ†é…ç‹¬ç«‹çª—å£ |
| Expertçª—å£ | `#E1`, `#E2`, ... | Claude ä¸“ç”¨å®¡æ ¸çª—å£ |
| Backendçª—å£ | `#B1`, `#B2`, ... | Codex ä¸“ç”¨å®ç°çª—å£ |
| Frontendçª—å£ | `#F1`, `#F2`, ... | Gemini ä¸“ç”¨å®ç°çª—å£ |

### 2.2 çª—å£ç­–ç•¥

- **ä¸²è¡Œæ­¥éª¤**ï¼šæ–°å¼€çª—å£ï¼Œç¼–å·é€’å¢ï¼Œé¿å…å†å²ä¸Šä¸‹æ–‡å¹²æ‰°ï¼›ä»…åœ¨åŒè§’è‰²ä¸”åŒå·¥ä½œåŒ…çš„è¿ç»­ç»†åŒ–æ—¶å¤ç”¨
- **å¹¶è¡Œæ­¥éª¤**ï¼šä¸ºæ¯ä¸ªå¹¶è¡ŒAgentåˆ†é…ç‹¬ç«‹çª—å£ç¼–å·ï¼Œäº’ä¸å…±äº«ä¸Šä¸‹æ–‡ï¼›å®Œæˆåå°†ç»“æœæ±‡æ€»åˆ°åç»­ä¸²è¡Œçª—å£
- **ç»§æ‰¿ç­–ç•¥**ï¼šåŒä¸€Agentçš„è¿ç»­ä»»åŠ¡å¯ç»§æ‰¿çª—å£ï¼Œä½†éœ€æ˜ç¡®å£°æ˜ä¸Šä¸‹æ–‡æ¥æº

### 2.3 ä¿¡æ¯ä¼ é€’æµç¨‹

```
é˜¶æ®µå¯åŠ¨ â†’ Agentçª—å£åˆ†é… â†’ ä»»åŠ¡æ‰§è¡Œ â†’ äº§å‡ºæäº¤ â†’ éªŒæ”¶å®¡æ ¸ â†’ ä¸‹ä¸€é˜¶æ®µ
     â”‚           â”‚              â”‚           â”‚           â”‚
     â”‚           â”‚              â”‚           â”‚           â””â”€â”€ Expert éªŒæ”¶åå‘æ”¾å¯åŠ¨è®¸å¯
     â”‚           â”‚              â”‚           â””â”€â”€ ç»“æœç²˜è´´åˆ°éªŒæ”¶çª—å£
     â”‚           â”‚              â””â”€â”€ æŒ‰å·¥ä½œåŒ…èŒƒå›´æ”¹åŠ¨
     â”‚           â””â”€â”€ æ–°å¼€/ç»§æ‰¿çª—å£
     â””â”€â”€ æ˜ç¡®ä¾èµ–å’Œè¾“å…¥
```

### 2.4 Phase 1 çª—å£åˆ†é…è¡¨

| çª—å£ID | Agent | Stage | çŠ¶æ€ | ç»§æ‰¿è‡ª |
|--------|-------|-------|------|--------|
| #E1 | Expert (Claude) | 1.1-1.3 | æ´»è·ƒ | - |
| #B1 | Backend (Codex) | 1.1 | - | - |
| #B2 | Backend (Codex) | 1.2 | - | - |
| #F1 | Frontend (Gemini) | 1.2-1.3 | - | - |
| #E2 | Expert (Claude) | 2.1, 3.1 | - | - |
| #B3 | Backend (Codex) | 2.1 | - | - |
| #F2 | Frontend (Gemini) | 2.1 | - | - |
| #B4 | Backend (Codex) | 3.1 | - | - |
| #F3 | Frontend (Gemini) | 3.1 | - | - |

---

## 3. Phase 1 æ‰§è¡Œè·¯çº¿å›¾

### 3.1 æ•´ä½“æ—¶åºå›¾

```
Week 1-2: å·¥ä½œæµæŒä¹…åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 1.1: Supabase æ•°æ®è¡¨è®¾è®¡                                           â”‚
â”‚ [Expert å®¡æ ¸] â”€â”€â–¶ [Backend å®ç°] â”€â”€â–¶ [Expert éªŒæ”¶]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 1.2: åç«¯API + å‰ç«¯Hook (å¹¶è¡Œ)                                     â”‚
â”‚ [Backend: APIå®ç°] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Expert è”è°ƒå®¡æ ¸]         â”‚
â”‚ [Frontend: Hookå®ç°] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 1.3: ç»„ä»¶æ”¹é€                                                       â”‚
â”‚ [Frontend å®ç°] â”€â”€â–¶ [Expert å®¡æ ¸]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 2-3: æµ‹è¯•ä½“ç³» (ä¸Stage 1.2å¹¶è¡Œå¯åŠ¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 2.1: åç«¯æµ‹è¯• + å‰ç«¯æµ‹è¯• (å¹¶è¡Œ)                                    â”‚
â”‚ [Backend: pytest] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Expert CIé…ç½®+å®¡æ ¸]       â”‚
â”‚ [Frontend: vitest] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 3-4: Sentry ç›‘æ§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 3.1: Sentry é›†æˆ (å¹¶è¡Œ)                                            â”‚
â”‚ [Backend: sentry-sdk] â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Expert å‘Šè­¦è§„åˆ™é…ç½®]       â”‚
â”‚ [Frontend: @sentry/react] â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ‰§è¡Œå¯åŠ¨é¡ºåº

| æ—¥æœŸ | çª—å£ | ä»»åŠ¡ | Agent |
|------|------|------|-------|
| Day 1 | #E1 | Stage 1.1 æ•°æ®è¡¨å®¡æ ¸ | Claude |
| Day 1 | #B3 | Stage 2.1 åç«¯æµ‹è¯•ï¼ˆå¹¶è¡Œå¯åŠ¨ï¼‰ | Codex |
| Day 1 | #F2 | Stage 2.1 å‰ç«¯æµ‹è¯•ï¼ˆå¹¶è¡Œå¯åŠ¨ï¼‰ | Gemini |
| Day 2 | #B1 | Stage 1.1 æ•°æ®è¡¨å®ç° | Codex |
| Day 2 | #E1 | Stage 1.1 éªŒæ”¶ | Claude |
| Day 3-4 | #B2 | Stage 1.2 API å®ç°ï¼ˆå¹¶è¡Œï¼‰ | Codex |
| Day 3-4 | #F1 | Stage 1.2 Hook å®ç°ï¼ˆå¹¶è¡Œï¼‰ | Gemini |
| Day 4 | #E1 | Stage 1.2 è”è°ƒå®¡æ ¸ | Claude |
| Day 5 | #F1 | Stage 1.3 ç»„ä»¶æ”¹é€  | Gemini |
| Day 5 | #E1 | Stage 1.3 æœ€ç»ˆéªŒæ”¶ | Claude |
| Day 5 | #E2 | Stage 2.1 CI é…ç½® | Claude |
| Day 6-7 | #B4 | Stage 3.1 åç«¯Sentryï¼ˆå¹¶è¡Œï¼‰ | Codex |
| Day 6-7 | #F3 | Stage 3.1 å‰ç«¯Sentryï¼ˆå¹¶è¡Œï¼‰ | Gemini |
| Day 7 | #E2 | Stage 3.1 å‘Šè­¦é…ç½® | Claude |

---

## 4. Stage è¯¦ç»†æ‰§è¡Œæ–¹æ¡ˆ

### 4.1 Stage 1.1: Supabase æ•°æ®è¡¨è®¾è®¡

| é¡¹ç›® | å€¼ |
|------|-----|
| **è´Ÿè´£Agent** | `@Expert` â†’ `@Backend` â†’ `@Expert` |
| **çª—å£ç­–ç•¥** | Expert #E1(æ–°å¼€) â†’ Backend #B1(æ–°å¼€) â†’ Expert #E1(ç»§æ‰¿) |
| **é¢„ä¼°æ—¶é—´** | 0.5 å¤© |
| **è¾“å…¥ä¾èµ–** | æ—  |
| **è¾“å‡ºäº§å‡º** | SQL DDLè„šæœ¬ã€RLSç­–ç•¥ |

#### Step 1: Expert æ–¹æ¡ˆå®¡æ ¸ (æ–°çª—å£ #E1)

```markdown
# Agent å¯åŠ¨ Prompt: @Expert #E1 - æ•°æ®è¡¨è®¾è®¡å®¡æ ¸

## ä½ çš„è§’è‰²
ä½ æ˜¯ Claudeï¼Œä¸€ä½ä¸¥è°¨çš„ä»£ç æ¶æ„ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®¡æ ¸å¹¶ä¼˜åŒ– GridWorkflow é¡¹ç›®çš„ Supabase æ•°æ®è¡¨è®¾è®¡æ–¹æ¡ˆã€‚

## å…¨å±€çº¦æŸ
- å¿…é¡»éµå®ˆ docs/active/multi-agent/FROZEN_INVARIANTS.md çš„å…¨å±€å†»ç»“é¡¹
- åªæ”¹ docs/** ä¸ backend/sql/**

## é¡¹ç›®èƒŒæ™¯
GridWorkflow æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„è§†é¢‘åˆ›ä½œå·¥ä½œæµå¹³å°ï¼Œéœ€è¦å®ç°å·¥ä½œæµçŠ¶æ€æŒä¹…åŒ–åŠŸèƒ½ã€‚
- æŠ€æœ¯æ ˆï¼šFastAPI + React + Supabase + Vercel
- å½“å‰é—®é¢˜ï¼šåˆ·æ–°é¡µé¢åå·¥ä½œæµè¿›åº¦ä¸¢å¤±
- ç›®æ ‡ï¼šç”¨æˆ·å¯ä»¥æ¢å¤ä¸­æ–­çš„å·¥ä½œæµ

## ä½ çš„ä»»åŠ¡
1. å®¡æ ¸ä»¥ä¸‹æ•°æ®è¡¨è®¾è®¡æ–¹æ¡ˆçš„åˆç†æ€§
2. æ£€æŸ¥ RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥æ˜¯å¦æ­£ç¡®
3. è¯„ä¼°æ˜¯å¦æœ‰æ½œåœ¨çš„æ€§èƒ½é—®é¢˜
4. è¾“å‡ºä¼˜åŒ–å»ºè®®å’Œæœ€ç»ˆç¡®è®¤çš„ SQL DDL

## å¾…å®¡æ ¸çš„è¡¨è®¾è®¡

### workflow_sessions è¡¨
â€‹```sql
CREATE TABLE workflow_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  status TEXT NOT NULL DEFAULT 'draft',
  current_step INTEGER NOT NULL DEFAULT 1,
  input_data JSONB DEFAULT '{}',
  concept_result JSONB,
  storyboard_result JSONB,
  video_prompt_result JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
â€‹```

### video_tasks è¡¨
â€‹```sql
CREATE TABLE video_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID REFERENCES workflow_sessions(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  task_id TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'pending',
  progress INTEGER DEFAULT 0,
  result_url TEXT,
  error_message TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
â€‹```

### RLS ç­–ç•¥
â€‹```sql
ALTER TABLE workflow_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE video_tasks ENABLE ROW LEVEL SECURITY;

CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ä¼šè¯" ON workflow_sessions
  FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ä»»åŠ¡" ON video_tasks
  FOR ALL USING (auth.uid() = user_id);
â€‹```

## è¾“å‡ºè¦æ±‚
1. é€é¡¹å®¡æ ¸ç»“è®ºï¼ˆé€šè¿‡/éœ€ä¿®æ”¹ï¼‰
2. å…·ä½“ä¿®æ”¹å»ºè®®ï¼ˆå¦‚æœ‰ï¼‰
3. æœ€ç»ˆç¡®è®¤çš„å®Œæ•´ SQL DDLï¼ˆå¯ç›´æ¥æ‰§è¡Œï¼‰
4. ç»™ @Backend Agent çš„å®ç°å»ºè®®

## é‡è¦çº¦æŸ
- status å­—æ®µçš„å…è®¸å€¼åº”è¯¥æ˜ç¡®å®šä¹‰
- è€ƒè™‘æ˜¯å¦éœ€è¦ updated_at çš„è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨
- ç´¢å¼•ç­–ç•¥å»ºè®®
```

#### Step 2: Backend æ•°æ®è¡¨å®ç° (æ–°çª—å£ #B1)

```markdown
# Agent å¯åŠ¨ Prompt: @Backend #B1 - Supabase æ•°æ®è¡¨å®ç°

## ä½ çš„è§’è‰²
ä½ æ˜¯ Codexï¼Œä¸€ä½å¯é çš„åç«¯å¼€å‘ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åœ¨ Supabase ä¸­å®ç°å·¥ä½œæµæŒä¹…åŒ–çš„æ•°æ®è¡¨ã€‚

## å…¨å±€çº¦æŸ
- å¿…é¡»éµå®ˆ docs/active/multi-agent/FROZEN_INVARIANTS.md çš„å…¨å±€å†»ç»“é¡¹
- åªæ”¹ backend/** ä¸ docs/**

## é¡¹ç›®ä¿¡æ¯
- ä»“åº“ï¼šhttps://gitee.com/chengdu-flower-food/grid-workflow
- åˆ†æ”¯ï¼šmain
- Supabase é¡¹ç›®éœ€è¦å¼€å‘è€…æä¾›è®¿é—®å‡­æ®

## æ¥è‡ª @Expert #E1 çš„å®¡æ ¸ç»“æœ
[æ­¤å¤„ç²˜è´´ Expert çš„å®¡æ ¸è¾“å‡º]

## ä½ çš„ä»»åŠ¡
1. æ ¹æ® Expert å®¡æ ¸é€šè¿‡çš„ SQL DDLï¼Œåœ¨ Supabase ä¸­æ‰§è¡Œ
2. åˆ›å»ºå¿…è¦çš„ç´¢å¼•
3. åˆ›å»º updated_at è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨
4. éªŒè¯ RLS ç­–ç•¥æ˜¯å¦ç”Ÿæ•ˆ
5. è®°å½•å®æ–½è¿‡ç¨‹å’Œä»»ä½•è°ƒæ•´

## è¾“å‡ºè¦æ±‚
1. æ‰§è¡Œçš„å®Œæ•´ SQL è„šæœ¬ï¼ˆåŒ…å«æ‰€æœ‰ä¿®æ”¹ï¼‰
2. æ‰§è¡Œç»“æœæˆªå›¾æˆ–æ—¥å¿—
3. éªŒè¯æµ‹è¯•ç»“æœï¼ˆå°è¯•ç”¨ä¸åŒç”¨æˆ·æŸ¥è¯¢ï¼‰
4. é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
5. ç»™ @Expert çš„éªŒæ”¶æ£€æŸ¥ç‚¹æ¸…å•

## æ–‡ä»¶è¾“å‡º
å°†æœ€ç»ˆçš„ SQL è„šæœ¬ä¿å­˜åˆ°ï¼š
`backend/sql/SCHEMA_WORKFLOW_PERSISTENCE.sql`

## æ³¨æ„äº‹é¡¹
- å¦‚æœæ²¡æœ‰ Supabase è®¿é—®æƒé™ï¼Œè¯·è¾“å‡ºå®Œæ•´å¯æ‰§è¡Œçš„ SQL è„šæœ¬ä¾›å¼€å‘è€…æ‰§è¡Œ
- ä¸è¦ä¿®æ”¹ä»»ä½•ç°æœ‰è¡¨ç»“æ„
- ç¡®ä¿æ‰€æœ‰æ“ä½œå¯å›æ»š
```

#### Step 3: Expert éªŒæ”¶ (ç»§æ‰¿çª—å£ #E1)

```markdown
# Agent ç»§ç»­ Prompt: @Expert #E1 - æ•°æ®è¡¨å®ç°éªŒæ”¶

## æ¥è‡ª @Backend #B1 çš„å®ç°ç»“æœ
[æ­¤å¤„ç²˜è´´ Backend çš„å®ç°è¾“å‡º]

## éªŒæ”¶ä»»åŠ¡
1. æ£€æŸ¥ SQL è„šæœ¬æ˜¯å¦ä¸å®¡æ ¸æ–¹æ¡ˆä¸€è‡´
2. éªŒè¯ RLS ç­–ç•¥æ˜¯å¦å®Œæ•´
3. ç¡®è®¤ç´¢å¼•å’Œè§¦å‘å™¨æ˜¯å¦æ­£ç¡®
4. è¾“å‡ºæœ€ç»ˆéªŒæ”¶ç»“è®º

## è¾“å‡º
- éªŒæ”¶ç»“è®ºï¼šé€šè¿‡/éœ€è¿”å·¥
- é—®é¢˜åˆ—è¡¨ï¼ˆå¦‚æœ‰ï¼‰
- Stage 1.2 å¯åŠ¨è®¸å¯
```

---

### 4.2 Stage 1.2: åç«¯ API + å‰ç«¯ Hook (å¹¶è¡Œ)

| é¡¹ç›® | å€¼ |
|------|-----|
| **è´Ÿè´£Agent** | `@Backend` + `@Frontend` å¹¶è¡Œï¼Œ`@Expert` å®¡æ ¸ |
| **çª—å£ç­–ç•¥** | Backend #B2(æ–°å¼€)ï¼ŒFrontend #F1(æ–°å¼€)ï¼ŒExpert #E1(ç»§æ‰¿) |
| **é¢„ä¼°æ—¶é—´** | 2 å¤© |
| **è¾“å…¥ä¾èµ–** | Stage 1.1 å®Œæˆ |
| **è¾“å‡ºäº§å‡º** | åç«¯APIä»£ç ã€å‰ç«¯Hookä»£ç  |

#### Step 1a: Backend API å®ç° (æ–°çª—å£ #B2ï¼Œä¸ #F1 å¹¶è¡Œ)

```markdown
# Agent å¯åŠ¨ Prompt: @Backend #B2 - Sessions API å®ç°

## ä½ çš„è§’è‰²
ä½ æ˜¯ Codexï¼Œè´Ÿè´£å®ç° GridWorkflow çš„å·¥ä½œæµä¼šè¯ç®¡ç† APIã€‚

## å…¨å±€çº¦æŸ
- å¿…é¡»éµå®ˆ docs/active/multi-agent/FROZEN_INVARIANTS.md çš„å…¨å±€å†»ç»“é¡¹
- ç»Ÿä¸€å“åº”æ ¼å¼ï¼š`{ ok, data, error }`
- åªæ”¹ backend/**

## é¡¹ç›®ä¸Šä¸‹æ–‡
- ä»“åº“ï¼šhttps://gitee.com/chengdu-flower-food/grid-workflow
- åç«¯æ¡†æ¶ï¼šFastAPI
- æ•°æ®åº“ï¼šSupabase (PostgreSQL)
- è®¤è¯ï¼šSupabase Auth + JWT

## æ¥è‡ª Stage 1.1 çš„äº§å‡º
æ•°æ®è¡¨å·²åˆ›å»ºï¼šworkflow_sessions, video_tasks
RLS ç­–ç•¥å·²é…ç½®ã€‚

## ä½ çš„ä»»åŠ¡
å®ç°ä»¥ä¸‹ API ç«¯ç‚¹ï¼š

### 1. POST /api/v1/sessions
åˆ›å»ºæ–°çš„å·¥ä½œæµä¼šè¯
- éœ€è¦ JWT è®¤è¯
- è¯·æ±‚ä½“ï¼š`{ input_data?: object }`
- è¿”å›ï¼š`{ ok: true, data: WorkflowSession, error: null }`

### 2. GET /api/v1/sessions/{session_id}
è·å–ä¼šè¯è¯¦æƒ…
- éœ€è¦ JWT è®¤è¯ + æ‰€æœ‰æƒéªŒè¯
- è¿”å›ï¼š`{ ok: true, data: WorkflowSession, error: null }`

### 3. PATCH /api/v1/sessions/{session_id}
æ›´æ–°ä¼šè¯çŠ¶æ€
- éœ€è¦ JWT è®¤è¯ + æ‰€æœ‰æƒéªŒè¯
- è¯·æ±‚ä½“ï¼š`{ status?, current_step?, concept_result?, ... }`
- è¿”å›ï¼š`{ ok: true, data: WorkflowSession, error: null }`

### 4. GET /api/v1/sessions/{session_id}/tasks
è·å–ä¼šè¯çš„è§†é¢‘ä»»åŠ¡åˆ—è¡¨
- éœ€è¦ JWT è®¤è¯ + æ‰€æœ‰æƒéªŒè¯
- è¿”å›ï¼š`{ ok: true, data: VideoTask[], error: null }`

### 5. POST /api/v1/sessions/{session_id}/tasks
ä¸ºä¼šè¯æ·»åŠ è§†é¢‘ä»»åŠ¡
- éœ€è¦ JWT è®¤è¯ + æ‰€æœ‰æƒéªŒè¯
- è¯·æ±‚ä½“ï¼š`{ task_id: string }`
- è¿”å›ï¼š`{ ok: true, data: VideoTask, error: null }`

## æ–‡ä»¶ç»“æ„
â€‹```
backend/app/
â”œâ”€â”€ api/routes/sessions.py      # æ–°å¢
â”œâ”€â”€ schemas/sessions.py         # æ–°å¢
â””â”€â”€ services/session_service.py # æ–°å¢
â€‹```

## è¾“å‡ºè¦æ±‚
1. å®Œæ•´çš„ä»£ç å®ç°ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰
2. æ¯ä¸ªç«¯ç‚¹çš„æµ‹è¯• curl å‘½ä»¤ç¤ºä¾‹
3. ç»™ @Frontend çš„ API å¥‘çº¦è¯´æ˜ï¼ˆæ¥å£æ–‡æ¡£ï¼‰
4. ç»™ @Expert çš„ä»£ç å®¡æŸ¥è¦ç‚¹

## é‡è¦çº¦æŸ
- éµå¾ªç°æœ‰ä»£ç é£æ ¼ï¼ˆå‚è€ƒ video.pyï¼‰
- é”™è¯¯å¤„ç†ä¸ç°æœ‰ä¸€è‡´
- ä¸å¼•å…¥æ–°çš„ä¾èµ–
```

#### Step 1b: Frontend Hook å®ç° (æ–°çª—å£ #F1ï¼Œä¸ #B2 å¹¶è¡Œ)

```markdown
# Agent å¯åŠ¨ Prompt: @Frontend #F1 - useWorkflowPersistence Hook å®ç°

## ä½ çš„è§’è‰²
ä½ æ˜¯ Geminiï¼Œè´Ÿè´£å®ç° GridWorkflow çš„å‰ç«¯å·¥ä½œæµæŒä¹…åŒ– Hookã€‚

## å…¨å±€çº¦æŸ
- å¿…é¡»éµå®ˆ docs/active/multi-agent/FROZEN_INVARIANTS.md çš„å…¨å±€å†»ç»“é¡¹
- æ‰€æœ‰ API è¯·æ±‚é€šè¿‡ apiClient.ts
- UI æ–‡æ¡ˆä½¿ç”¨ç®€ä½“ä¸­æ–‡
- åªæ”¹ frontend/**

## é¡¹ç›®ä¸Šä¸‹æ–‡
- ä»“åº“ï¼šhttps://gitee.com/chengdu-flower-food/grid-workflow
- å‰ç«¯æ¡†æ¶ï¼šReact 19 + TypeScript + Vite
- çŠ¶æ€ç®¡ç†ï¼šReact Context + Hooks
- æ ·å¼ï¼šTailwind CSS
- è®¤è¯ï¼šSupabase Auth

## æ¥è‡ª Stage 1.1 çš„äº§å‡º
æ•°æ®è¡¨ç»“æ„ï¼š
- workflow_sessions (id, user_id, status, current_step, input_data, concept_result, storyboard_result, video_prompt_result)
- video_tasks (id, session_id, user_id, task_id, status, progress, result_url, error_message)

## ä½ çš„ä»»åŠ¡
å®ç° `useWorkflowPersistence` Hookï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

### Hook API è®¾è®¡
â€‹```typescript
interface UseWorkflowPersistence {
  // çŠ¶æ€
  session: WorkflowSession | null;
  tasks: VideoTask[];
  loading: boolean;
  error: string | null;
  
  // æ“ä½œ
  updateSession: (updates: Partial<WorkflowSession>) => Promise<void>;
  saveStepResult: (step: number, result: object) => Promise<void>;
  addTask: (taskId: string) => Promise<void>;
  updateTask: (taskId: string, updates: Partial<VideoTask>) => Promise<void>;
  startNewSession: () => Promise<void>;
  refreshTasks: () => Promise<void>;
}
â€‹```

### å®ç°è¦æ±‚
1. ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨æ¢å¤æˆ–åˆ›å»ºä¼šè¯
2. ä½¿ç”¨ localStorage ç¼“å­˜ session_id
3. ç¼“å­˜çš„ä¼šè¯ä¸å­˜åœ¨æ—¶æ¸…ç†å¹¶åˆ›å»ºæ–°ä¼šè¯
4. Supabase æŸ¥è¯¢ç»“æœä¸¥æ ¼æ ¡éªŒ (error === null && data !== null)
5. é”™è¯¯çŠ¶æ€å‹å¥½å±•ç¤º

## æ–‡ä»¶ç»“æ„
â€‹```
frontend/src/
â”œâ”€â”€ hooks/useWorkflowPersistence.ts  # æ–°å¢
â”œâ”€â”€ types/workflow.ts                 # æ–°å¢
â””â”€â”€ services/sessionService.ts        # æ–°å¢ï¼ˆå¯é€‰ï¼‰
â€‹```

## è¾“å‡ºè¦æ±‚
1. å®Œæ•´çš„ Hook ä»£ç å®ç°
2. ç±»å‹å®šä¹‰æ–‡ä»¶
3. ä½¿ç”¨ç¤ºä¾‹ä»£ç 
4. ç»™ @Expert çš„ä»£ç å®¡æŸ¥è¦ç‚¹
5. ç»™ @Backend çš„ API è°ƒç”¨æ ¼å¼ç¡®è®¤

## é‡è¦çº¦æŸ
- ä¸è¦ç›´æ¥ä¿®æ”¹ GridWorkflow.tsxï¼ˆStage 1.3 å†åšï¼‰
- éµå¾ªç°æœ‰ä»£ç é£æ ¼
- ä½¿ç”¨ supabase.from() è€ŒéåŸç”Ÿ fetch
```

#### Step 2: Expert è”è°ƒå®¡æ ¸ (ç»§æ‰¿çª—å£ #E1)

```markdown
# Agent ç»§ç»­ Prompt: @Expert #E1 - API + Hook è”è°ƒå®¡æ ¸

## æ¥è‡ª @Backend #B2 çš„ API å®ç°
[æ­¤å¤„ç²˜è´´ Backend çš„ä»£ç è¾“å‡º]

## æ¥è‡ª @Frontend #F1 çš„ Hook å®ç°
[æ­¤å¤„ç²˜è´´ Frontend çš„ä»£ç è¾“å‡º]

## å®¡æ ¸ä»»åŠ¡
1. **å¥‘çº¦ä¸€è‡´æ€§æ£€æŸ¥**
   - API å“åº”æ ¼å¼æ˜¯å¦ä¸ Hook æœŸæœ›ä¸€è‡´
   - å­—æ®µå‘½åæ˜¯å¦ç»Ÿä¸€ (snake_case vs camelCase)
   - é”™è¯¯ç æ˜¯å¦èƒ½è¢«å‰ç«¯æ­£ç¡®å¤„ç†

2. **ä»£ç è´¨é‡æ£€æŸ¥**
   - åç«¯ï¼šå®‰å…¨æ€§ã€æ€§èƒ½ã€é”™è¯¯å¤„ç†
   - å‰ç«¯ï¼šç±»å‹å®‰å…¨ã€å†…å­˜æ³„æ¼ã€è¾¹ç•Œæƒ…å†µ

3. **å†»ç»“é¡¹ç¬¦åˆæ€§**
   - å“åº”ç»“æ„æ˜¯å¦ç¬¦åˆ `{ok, data, error}`
   - å‰ç«¯æ˜¯å¦é€šè¿‡ apiClient è°ƒç”¨
   - é”™è¯¯ä¿¡æ¯æ˜¯å¦è„±æ•

## è¾“å‡ºè¦æ±‚
1. å®¡æ ¸ç»“è®ºï¼šé€šè¿‡/éœ€ä¿®æ”¹
2. å…·ä½“é—®é¢˜åˆ—è¡¨å’Œä¿®æ”¹å»ºè®®ï¼ˆå¦‚æœ‰ï¼‰
3. ç»™ @Backend å’Œ @Frontend çš„ä¿®æ”¹æŒ‡ä»¤ï¼ˆå¦‚éœ€ï¼‰
4. Stage 1.3 å¯åŠ¨è®¸å¯
```

---

### 4.3 Stage 1.3: ç»„ä»¶æ”¹é€ 

| é¡¹ç›® | å€¼ |
|------|-----|
| **è´Ÿè´£Agent** | `@Frontend` â†’ `@Expert` |
| **çª—å£ç­–ç•¥** | Frontend #F1(ç»§æ‰¿)ï¼ŒExpert #E1(ç»§æ‰¿) |
| **é¢„ä¼°æ—¶é—´** | 1 å¤© |
| **è¾“å…¥ä¾èµ–** | Stage 1.2 å®Œæˆ |
| **è¾“å‡ºäº§å‡º** | æ”¹é€ åçš„ GridWorkflow.tsx |

#### Step 1: Frontend ç»„ä»¶æ”¹é€  (ç»§æ‰¿çª—å£ #F1)

```markdown
# Agent ç»§ç»­ Prompt: @Frontend #F1 - GridWorkflow ç»„ä»¶æ”¹é€ 

## æ¥è‡ª @Expert #E1 çš„å®¡æ ¸ç»“æœ
[æ­¤å¤„ç²˜è´´ Expert çš„å®¡æ ¸é€šè¿‡ç¡®è®¤]

## ä½ çš„ä»»åŠ¡
å°† `useWorkflowPersistence` Hook é›†æˆåˆ° `GridWorkflow.tsx` ç»„ä»¶ã€‚

## æ”¹é€ è¦æ±‚
1. **å¼•å…¥æŒä¹…åŒ– Hook**
2. **åˆå§‹åŒ–æ—¶æ¢å¤çŠ¶æ€** - ä» session æ¢å¤ currentStep, inputData, results
3. **æ­¥éª¤å®Œæˆæ—¶ä¿å­˜** - handleGenerateConcept æˆåŠŸåè°ƒç”¨ saveStepResult
4. **è§†é¢‘ç”Ÿæˆæ—¶è®°å½•ä»»åŠ¡** - handleGenerateVideo æˆåŠŸåè°ƒç”¨ addTask
5. **ä»»åŠ¡çŠ¶æ€æ›´æ–°** - è½®è¯¢ç»“æœåè°ƒç”¨ updateTask
6. **é‡ç½®åŠŸèƒ½** - handleReset æ—¶è°ƒç”¨ startNewSession

## UI è¦æ±‚
- æ·»åŠ  loading çŠ¶æ€çš„éª¨æ¶å±
- æ·»åŠ é”™è¯¯æç¤º Toastï¼ˆä¸­æ–‡ï¼‰
- ä¿æŒç°æœ‰è§†è§‰é£æ ¼

## è¾“å‡ºè¦æ±‚
1. å®Œæ•´çš„æ”¹é€ åçš„ GridWorkflow.tsx
2. å˜æ›´è¯´æ˜ï¼ˆæ”¹äº†å“ªäº›åœ°æ–¹ï¼‰
3. æµ‹è¯•åœºæ™¯æ¸…å•
4. ç»™ @Expert çš„éªŒæ”¶æ£€æŸ¥ç‚¹
```

#### Step 2: Expert æœ€ç»ˆéªŒæ”¶ (ç»§æ‰¿çª—å£ #E1)

```markdown
# Agent ç»§ç»­ Prompt: @Expert #E1 - å·¥ä½œæµæŒä¹…åŒ–æœ€ç»ˆéªŒæ”¶

## æ¥è‡ª @Frontend #F1 çš„ç»„ä»¶æ”¹é€ ç»“æœ
[æ­¤å¤„ç²˜è´´ Frontend çš„ä»£ç è¾“å‡º]

## éªŒæ”¶æ£€æŸ¥æ¸…å•
1. â–¡ åˆ·æ–°é¡µé¢åçŠ¶æ€å¯æ¢å¤
2. â–¡ æ–°ç”¨æˆ·è®¿é—®æ—¶åˆ›å»ºæ–°ä¼šè¯
3. â–¡ æ­¥éª¤ç»“æœæ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
4. â–¡ è§†é¢‘ä»»åŠ¡æ­£ç¡®å…³è”ä¼šè¯
5. â–¡ é”™è¯¯å¤„ç†å‹å¥½ï¼ˆä¸­æ–‡æç¤ºï¼‰
6. â–¡ ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
7. â–¡ æ— æ€§èƒ½é—®é¢˜ï¼ˆä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼‰
8. â–¡ ç¬¦åˆå…¨å±€å†»ç»“é¡¹

## è¾“å‡ºè¦æ±‚
1. æœ€ç»ˆéªŒæ”¶ç»“è®ºï¼šé€šè¿‡/éœ€è¿”å·¥
2. é—®é¢˜åˆ—è¡¨å’Œä¿®æ”¹æŒ‡ä»¤ï¼ˆå¦‚éœ€è¿”å·¥ï¼‰
3. Stage 1 çš„æ€»ç»“æŠ¥å‘Š
4. ç»™å¼€å‘è€…çš„éƒ¨ç½²/æµ‹è¯•æŒ‡å¯¼
```

---

### 4.4 Stage 2.1: æµ‹è¯•ä½“ç³»å»ºè®¾ (ä¸ Stage 1.2 å¹¶è¡Œå¯åŠ¨)

| é¡¹ç›® | å€¼ |
|------|-----|
| **è´Ÿè´£Agent** | `@Backend` + `@Frontend` å¹¶è¡Œï¼Œ`@Expert` å®¡æ ¸ |
| **çª—å£ç­–ç•¥** | Backend #B3(æ–°å¼€)ï¼ŒFrontend #F2(æ–°å¼€)ï¼ŒExpert #E2(æ–°å¼€) |
| **é¢„ä¼°æ—¶é—´** | 5 å¤© |
| **è¾“å…¥ä¾èµ–** | æ— ï¼ˆå¯ä¸ Stage 1.2 å¹¶è¡Œï¼‰ |
| **è¾“å‡ºäº§å‡º** | pytest é…ç½®+ç”¨ä¾‹ã€vitest é…ç½®+ç”¨ä¾‹ã€GitHub Actions CI |

> è¯¦ç»† Prompt å‚è§ [PHASE_1_IMPLEMENTATION.md](../phase-1/PHASE_1_IMPLEMENTATION.md)

---

### 4.5 Stage 3.1: Sentry ç›‘æ§é›†æˆ

| é¡¹ç›® | å€¼ |
|------|-----|
| **è´Ÿè´£Agent** | `@Backend` + `@Frontend` å¹¶è¡Œï¼Œ`@Expert` é…ç½®å‘Šè­¦ |
| **çª—å£ç­–ç•¥** | Backend #B4(æ–°å¼€)ï¼ŒFrontend #F3(æ–°å¼€)ï¼ŒExpert #E2(ç»§æ‰¿) |
| **é¢„ä¼°æ—¶é—´** | 1.5 å¤© |
| **è¾“å…¥ä¾èµ–** | Stage 2.1 å®Œæˆï¼ˆæ¨èï¼‰æˆ– Stage 1.3 å®Œæˆï¼ˆæœ€ä½ï¼‰ |
| **è¾“å‡ºäº§å‡º** | Sentry é›†æˆä»£ç ã€å‘Šè­¦è§„åˆ™é…ç½® |

> è¯¦ç»† Prompt å‚è§ [PHASE_1_IMPLEMENTATION.md](../phase-1/PHASE_1_IMPLEMENTATION.md)

---

## 5. éªŒæ”¶ä¸é—¨ç¦æ‰§è¡Œ

### 5.1 éªŒæ”¶æ£€æŸ¥æµç¨‹

1. **Agent è‡ªæ£€**ï¼šäº¤ä»˜å‰é€é¡¹æ ¸å¯¹å†»ç»“é¡¹
2. **ä»£ç å®¡æŸ¥**ï¼šExpert å®¡æ ¸ä»£ç è´¨é‡å’Œè§„èŒƒç¬¦åˆæ€§
3. **å¥‘çº¦éªŒè¯**ï¼šæ£€æŸ¥ API å“åº”æ ¼å¼ã€é”™è¯¯ç ã€å­—æ®µå‘½å
4. **åŠŸèƒ½æµ‹è¯•**ï¼šæŒ‰éªŒæ”¶æ¸…å•æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•
5. **å®‰å…¨å®¡é˜…**ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•ã€å¤–éƒ¨è°ƒç”¨éš”ç¦»

### 5.2 é—¨ç¦è§„åˆ™

| é—¨ç¦ | è§¦å‘æ¡ä»¶ | åæœ |
|------|----------|------|
| å†»ç»“é¡¹è¿å | å“åº”ç»“æ„ä¸ç¬¦ã€å‰ç«¯ç›´è¿å¤–éƒ¨APIã€æš´éœ²å¯†é’¥ | ç›´æ¥é€€å› |
| æµ‹è¯•ä¸é€šè¿‡ | å•å…ƒæµ‹è¯•å¤±è´¥ã€é›†æˆæµ‹è¯•å¤±è´¥ | ä¿®å¤åé‡æ–°æäº¤ |
| å®‰å…¨å®¡é˜…ä¸é€šè¿‡ | æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€RLS é…ç½®é”™è¯¯ | ç›´æ¥é€€å› |

### 5.3 éªŒæ”¶äº§å‡ºç‰©

æ¯ä¸ª Stage å®Œæˆåå¿…é¡»äº§å‡ºï¼š
- [ ] ä»£ç å®ç°ï¼ˆå¯è¿è¡Œï¼‰
- [ ] éªŒæ”¶è¯æ®ï¼ˆæˆªå›¾/æ—¥å¿—ï¼‰
- [ ] æµ‹è¯•ç”¨ä¾‹æˆ–æµ‹è¯•ç»“æœ
- [ ] é£é™©ç‚¹è¯´æ˜ï¼ˆå¦‚æœ‰ï¼‰
- [ ] ç»™ä¸‹ä¸€ Stage çš„å»ºè®®

---

## 6. Git æäº¤æµç¨‹

### 6.1 æäº¤è§„èŒƒ

- æ¯ä¸ª Agent åœ¨å¯¹åº”çª—å£ä»»åŠ¡é€šè¿‡éªŒæ”¶åï¼Œé»˜è®¤æ‰§è¡Œä¸€æ¬¡æäº¤ä¸æ¨é€
- ä¿æŒå¯å®¡è®¡å†å²

### 6.2 åˆ†æ”¯/æäº¤è§„èŒƒ

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| åˆ†æ”¯ | `feature/<Stage>-<window>` | `feature/stage-1.1-B1` |
| æäº¤ä¿¡æ¯ | `<window> <Stage> <summary>` | `#B1 Stage-1.1 implement workflow tables` |

### 6.3 å®‰å…¨æ¸…å•

- [ ] `.env`ã€å¯†é’¥ã€ç§æœ‰è¯ä¹¦ä¸¥ç¦å…¥åº“
- [ ] ç¡®è®¤ `.gitignore` è¦†ç›–æ‰€æœ‰æ•æ„Ÿæ–‡ä»¶
- [ ] æäº¤å‰é™„éªŒæ”¶è¦ç‚¹ï¼šæˆåŠŸ/å¤±è´¥ç”¨ä¾‹

### 6.4 æ¨é€å‘½ä»¤

```bash
# å•æ¬¡æäº¤æ¨é€
git add -A
git commit -m "#B1 Stage-1.1 implement workflow tables"
git push all main

# æˆ–åˆ†åˆ«æ¨é€
git push gitee main
git push github main
```

---

## 7. æ£€æŸ¥æ¸…å•

### 7.1 Phase 1 å®Œæˆæ ‡å‡†

- [ ] å·¥ä½œæµåˆ·æ–°åå¯æ¢å¤
- [ ] åç«¯æµ‹è¯•è¦†ç›–ç‡ > 50%
- [ ] å‰ç«¯æµ‹è¯•è¦†ç›–ç‡ > 50%
- [ ] GitHub Actions CI é€šè¿‡
- [ ] Sentry å¯æ”¶åˆ°é”™è¯¯æŠ¥å‘Š
- [ ] å‘Šè­¦è§„åˆ™å·²é…ç½®

### 7.2 äº¤ä»˜ç‰©æ¸…å•

| äº¤ä»˜ç‰© | Stage | è´Ÿè´£Agent |
|--------|-------|-----------|
| SQL DDL è„šæœ¬ | 1.1 | Backend |
| åç«¯ API ä»£ç  | 1.2 | Backend |
| å‰ç«¯ Hook ä»£ç  | 1.2 | Frontend |
| æ”¹é€ åçš„ GridWorkflow.tsx | 1.3 | Frontend |
| åç«¯æµ‹è¯•ç”¨ä¾‹ | 2.1 | Backend |
| å‰ç«¯æµ‹è¯•ç”¨ä¾‹ | 2.1 | Frontend |
| CI é…ç½®æ–‡ä»¶ | 2.1 | Expert |
| Sentry é›†æˆä»£ç  | 3.1 | Backend + Frontend |
| å‘Šè­¦è§„åˆ™æ–‡æ¡£ | 3.1 | Expert |

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è·¯å¾„ | ç”¨é€” |
|------|------|------|
| å…¨å±€å†»ç»“é¡¹ | `./FROZEN_INVARIANTS.md` | ä¸å¯å˜çº¦æŸ |
| å¤šAgentè·¯çº¿å›¾ | `./ROADMAP_MULTI_AGENT.md` | å¹¶è¡Œ/ä¸²è¡Œç­–ç•¥ |
| å¤šAgentå·¥ä½œæµ | `./WORKFLOW_MULTI_AGENT.md` | è¯¦ç»†æŒ‡ä»¤æ¨¡æ¿ |
| Phase 1 å®æ–½æ–¹æ¡ˆ | `../phase-1/PHASE_1_IMPLEMENTATION.md` | è¯¦ç»†å®æ–½æ­¥éª¤ |
| ä¸»è®¡åˆ’ | `../../MASTER_PLAN_2026.md` | æ€»ä½“è§„åˆ’ |

### B. çª—å£å¯åŠ¨æŒ‡ä»¤æ¨¡æ¿

> ä½¿ç”¨æ–¹å¼ï¼šåœ¨å¯¹åº”çª—å£å‘é€æ•´æ®µæŒ‡ä»¤ï¼Œé™„ä¸Šç›¸å…³ä¸Šä¸‹æ–‡

```text
ã€#E1 Claude (Expert) / Stage 1.1ã€‘
è§’è‰²ï¼šClaudeï¼ˆExpertï¼Œæ¶æ„å®¡æ ¸ï¼‰
ä»»åŠ¡ï¼šæ‰§è¡Œ Stage 1.1 æ•°æ®è¡¨è®¾è®¡å®¡æ ¸ï¼›åªæ”¹ docs/**ï¼›æŒ‰éªŒæ”¶æ¸…å•å‡ºè¯æ®ã€‚
å…¨å±€çº¦æŸï¼šdocs/active/multi-agent/FROZEN_INVARIANTS.md
```

```text
ã€#B1 Codex (Backend) / Stage 1.1ã€‘
è§’è‰²ï¼šCodexï¼ˆåç«¯ï¼‰
ä»»åŠ¡ï¼šæ‰§è¡Œ Stage 1.1 æ•°æ®è¡¨å®ç°ï¼›åªæ”¹ backend/**ï¼›æŒ‰éªŒæ”¶æ¸…å•å‡ºè¯æ®ã€‚
å…¨å±€çº¦æŸï¼šdocs/active/multi-agent/FROZEN_INVARIANTS.md
```

```text
ã€#F1 Gemini (Frontend) / Stage 1.2ã€‘
è§’è‰²ï¼šGeminiï¼ˆå‰ç«¯ï¼‰
ä»»åŠ¡ï¼šæ‰§è¡Œ Stage 1.2 Hook å®ç°ï¼›åªæ”¹ frontend/**ï¼›æŒ‰éªŒæ”¶æ¸…å•å‡ºè¯æ®ã€‚
å…¨å±€çº¦æŸï¼šdocs/active/multi-agent/FROZEN_INVARIANTS.md
```

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Architect  
**æœ€åæ›´æ–°**: 2026-01-08  
**ç‰ˆæœ¬**: 2.0ï¼ˆæ•´åˆ WORKPACKS ç²¾åï¼‰
