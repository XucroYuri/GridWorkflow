# PLAN-12_DETACH_TO_NEW_REPO (从母体仓库剥离到 F:\Code\GridWorkflow)

**目标**：在完成对当前项目的学习与迁移复刻（有用逻辑与代码提取）后，将 `GRIDWORKFLOW_ROOT` 从 `Grid-Cine-Director` 母体仓库中剥离，迁移到新的目录（例如 `F:\Code\GridWorkflow`），并确保后续迭代不受路径残留与历史耦合干扰。

---

## 范围

**包含**：
- 明确“当前暂存工作区”与“未来独立仓库根目录”的关系
- 文档与计划中路径表述的规范化（避免硬编码残留）
- 剥离动作的执行顺序、验收与回滚策略

**不包含**：
- 具体代码迁移的逐文件清单（由迁移白名单另行维护）
- GitHub 仓库创建与 CI 配置细节（可在剥离后补充）

---

## 关键约定（路径与根目录）

- **当前暂存根目录（阶段 A）**：已迁移完成
- **目标独立根目录（阶段 B 以后）**：`GRIDWORKFLOW_ROOT`（项目根目录）
- **文档内路径规范**：
  - 尽量使用相对路径（相对于仓库根目录）
  - 必要时使用“根目录变量”表达：
    - `GRIDWORKFLOW_ROOT`：指代仓库根目录（阶段 A 为暂存目录，阶段 B 为独立目录）

---

## 剥离前置条件（必须满足）

1. `PRECHECK-SEC_ARCH_AGENT` 门禁通过（安全/稳定/Agent 友好）
2. `PLAN-11_MIGRATION_ACTIONS` 阶段 A-D 的文档归档完成，且目录结构稳定
3. 文档中不再出现“仅在母体仓库内成立”的硬编码路径（或已明确为暂存阶段路径）
4. 已明确后续开发只在独立仓库根目录进行，母体仓库进入只读状态

---

## 剥离执行路线图（建议顺序）

### 1) 冻结文档与契约（最后一次在母体内更新）

- 冻结项：
  - 统一响应结构 `{ ok, data, error }`
  - Prompt 单一来源（后端）
  - 前端 API Client 单一入口
  - UI 语言为简体中文
  - Prompt 输出语种由显式规则控制

### 2) 生成“剥离后基线检查”清单

- 目录层面：
  - `docs/`、`docs/api/`、`docs/requirements/` 均存在且引用路径一致
- 文档层面：
  - `PLAN-*` 可互相引用且不依赖母体仓库路径
- 运行层面：
  - 如已有代码骨架：前后端启动方式不依赖母体仓库的脚本与相对路径

### 3) 执行目录迁移

- 将整个项目迁移到独立目录（已完成）
- 新目录成为唯一工作区，母体仓库目录保持只读

### 4) 剥离后修复与统一（在新目录内进行）

- 更新所有文档中的“根目录”表述：
  - 将“暂存根目录”表述改为 `GRIDWORKFLOW_ROOT`
  - 将明确依赖母体仓库的引用替换为“迁移白名单”描述
- 若存在代码：
  - 前端环境变量 `VITE_API_BASE_URL` 与后端端口配置改为独立仓库默认值
  - 删除/替换任何指向 `Grid-Cine-Director` 的相对路径依赖

---

## 回滚策略

- 若剥离后出现不可预期问题：
  - 保留母体仓库内的暂存目录作为只读备份
  - 回滚到“阶段 A 暂存根目录”继续排查，直到剥离基线检查通过

---

## 验收

- 文档：
  - `docs/` 下所有 `PLAN-*`、`PRECHECK-*`、`PDCA-*` 均可在新目录中自洽阅读
  - 不存在对母体仓库绝对路径的强依赖描述（如必须存在，则标注为“仅阶段 A 暂存有效”）
- 工程（如已落地骨架）：
  - 前端/后端启动与 API Base 不依赖母体仓库脚本
- 流程：
  - 之后所有开发在 `F:\Code\GridWorkflow` 进行，母体仓库只读不再引入新变更

---

## PDCA 钩子

- **Plan**: 明确暂存根目录与目标根目录，冻结剥离前置条件与验收项。
- **Do**: 完成归档与迁移动作，保持母体仓库只读。
- **Check**: 在新目录执行文档/路径/启动的基线检查，确保无路径残留干扰。
- **Act**: 若发现路径残留，优先通过文档与配置规范化修复，再进行下一轮迭代开发。

## Agent 上下文注入包
- **负责人团队**: Joint
- **本阶段目标**: 将 `GRIDWORKFLOW_ROOT` 从母体仓库剥离为独立目录/仓库，并清除路径残留。
- **输入**: 本文档、`PLAN-11_MIGRATION_ACTIONS.md`、`PRECHECK-SEC_ARCH_AGENT.md`、`AGENT-00_WORKSTREAMS.md`。
- **输出**: 独立目录（例如 `F:\Code\GridWorkflow`）与可独立迭代的文档/配置基线，迁移验收记录。
- **冻结约束**:
  - 剥离后所有开发只在新目录进行
  - 文档优先相对路径与 `GRIDWORKFLOW_ROOT` 概念，不写死母体路径
- **禁止事项（高风险）**:
  - 剥离后继续在母体仓库内做功能性开发
  - 引入指向母体仓库的相对路径依赖
- **验收 Checklist**:
  - 文档在新目录可自洽阅读
  - 启动与运行不依赖母体路径
  - 母体仓库只读
- **回滚策略**:
  - 保留母体内暂存目录只读备份，必要时回退排查后再剥离。
